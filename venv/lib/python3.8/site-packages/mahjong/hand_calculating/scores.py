# -*- coding: utf-8 -*-
from mahjong.hand_calculating.hand_config import HandConfig


class ScoresCalculator(object):

    def calculate_scores(self, han, fu, config, is_yakuman=False):
        """
        Calculate how much scores cost a hand with given han and fu
        :param han: int
        :param fu: int
        :param config: HandConfig object
        :param is_yakuman: boolean
        :return: a dictionary with main and additional cost
        for ron additional cost is always = 0
        for tsumo main cost is cost for dealer and additional is cost for player
        {'main': 1000, 'additional': 0}
        """

        # kazoe hand
        if han >= 14 and not is_yakuman:
            # Hands over 26+ han don't count as double yakuman
            if config.options.kazoe_limit == HandConfig.KAZOE_LIMITED:
                han = 14
            # Hands over 13+ is a sanbaiman
            elif config.options.kazoe_limit == HandConfig.KAZOE_SANBAIMAN:
                han = 13

        if han >= 5:
            if han >= 78:
                non_dealer_ron = 192000
                non_dealer_main = 126000
                non_dealer_additional = 66000
                dealer_ron = 288000
                dealer_main = 144000
            elif han >= 65:
                non_dealer_ron = 160000
                non_dealer_main = 105000
                non_dealer_additional = 55000
                dealer_ron = 240000
                dealer_main = 120000
            elif han >= 52:
                non_dealer_ron = 128000
                non_dealer_main = 84000
                non_dealer_additional = 44000
                dealer_ron = 192000
                dealer_main = 96000
            elif han >= 39:
                non_dealer_ron = 96000
                non_dealer_main = 63000
                non_dealer_additional = 33000
                dealer_ron = 144000
                dealer_main = 72000
            # double yakuman
            elif han >= 26:
                non_dealer_ron = 64000
                non_dealer_main = 42000
                non_dealer_additional = 22000
                dealer_ron = 96000
                dealer_main = 48000
            # kazoe yakuman
            elif han >= 14:
                non_dealer_ron = 32000
                non_dealer_main = 21000
                non_dealer_additional = 11000
                dealer_ron = 48000
                dealer_main = 24000
            # yakuman
            elif han >= 13 and is_yakuman:
                non_dealer_ron = 32000
                non_dealer_main = 21000
                non_dealer_additional = 11000
                dealer_ron = 48000
                dealer_main = 24000
            # sanbaiman
            elif han >= 11:
                non_dealer_ron = 24000
                non_dealer_main = 16000
                non_dealer_additional = 8000
                dealer_ron = 36000
                dealer_main = 18000
            # baiman
            elif han >= 8:
                non_dealer_ron = 16000
                non_dealer_main = 10000
                non_dealer_additional = 6000
                dealer_ron = 24000
                dealer_main = 12000
            # haneman
            elif han >= 6:
                non_dealer_ron = 12000
                non_dealer_main = 8000
                non_dealer_additional = 4000
                dealer_ron = 18000
                dealer_main = 9000
            else:
                non_dealer_ron = 8000
                non_dealer_main = 5000
                non_dealer_additional = 3000
                dealer_ron = 12000
                dealer_main = 6000

        else:
            base_points = fu * pow(2, 2 + han)
            non_dealer_ron = (4 * base_points + 999) // 1000 * 1000
            dealer_ron = (6 * base_points + 999) // 1000 * 1000

            if config.is_dealer:
                if dealer_ron >= 12000:
                    dealer_ron = 12000
                    dealer_main = 6000
                elif dealer_ron == 11000:
                    dealer_main = 6000
                elif dealer_ron == 10000 or dealer_ron == 9000:
                    dealer_main = 5000
                elif dealer_ron == 8000 or dealer_ron == 7000:
                    dealer_main = 4000
                elif dealer_ron == 6000 or dealer_ron == 5000:
                    dealer_main = 3000
                elif dealer_ron == 4000 or dealer_ron == 3000:
                    dealer_main = 2000
                elif dealer_ron == 2000:
                    dealer_main = 1000
            else:
                if non_dealer_ron >= 8000:
                    non_dealer_ron = 8000
                    non_dealer_main = 5000
                    non_dealer_additional = 3000
                elif non_dealer_ron == 7000:
                    non_dealer_main = 5000
                    non_dealer_additional = 2000
                elif non_dealer_ron == 6000:
                    non_dealer_main = 4000
                    non_dealer_additional = 2000
                elif non_dealer_ron == 5000:
                    non_dealer_main = 4000
                    non_dealer_additional = 1000
                elif non_dealer_ron == 4000:
                    non_dealer_main = 3000
                    non_dealer_additional = 1000
                elif non_dealer_ron == 3000:
                    non_dealer_main = 2000
                    non_dealer_additional = 1000
                elif non_dealer_ron == 2000:
                    non_dealer_main = 1000
                    non_dealer_additional = 1000
                elif non_dealer_ron == 1000:
                    non_dealer_main = 1000
                    non_dealer_additional = 1000

        if config.is_tsumo:
            if config.is_dealer:
                return {'main': dealer_main, 'additional': dealer_main}
            else:
                return {'main': non_dealer_main, 'additional': non_dealer_additional}
        else:
            if config.is_dealer:
                return {'main': dealer_ron, 'additional': 0}
            else:
                return {'main': non_dealer_ron, 'additional': 0}